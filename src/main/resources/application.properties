spring.application.name=sehub
#============================ Server Configuration
server.port=${SERVER_PORT:8080}
# Note: context-path removed - using WebMvcConfig to add /api prefix instead

# Forwarded Headers Configuration (for Nginx reverse proxy)
# Enable Spring Boot to understand X-Forwarded-* headers from Nginx/Cloudflare
server.forward-headers-strategy=framework
server.tomcat.protocol-header=x-forwarded-proto
server.tomcat.remote-ip-header=x-forwarded-for

spring.config.import=optional:file:.env[.properties],optional:file:/opt/sehub/.env[.properties],optional:file:/var/www/SEHUB-backend/.env[.properties]

# ============================ Database Configuration
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/sehub}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:root}

#============================ MongoDB config
spring.data.mongodb.uri=${MONGO_URI:mongodb://localhost:27017/chat}
spring.data.mongodb.auto-index-creation=true

#============================ Redis Config
# Connection settings
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:sehub@redis}
spring.data.redis.timeout=6000

# Lettuce connection pool settings
# max-active: Maximum number of connections that can be allocated by the pool at a given time
spring.data.redis.lettuce.pool.max-active=20
# max-idle: Maximum number of idle connections in the pool
spring.data.redis.lettuce.pool.max-idle=10
# min-idle: Minimum number of idle connections in the pool
spring.data.redis.lettuce.pool.min-idle=2
# time-between-eviction-runs: Time between runs of the idle object evictor thread
spring.data.redis.lettuce.pool.time-between-eviction-runs=10000
# max-wait: Maximum amount of time to wait for a connection from the pool (milliseconds)
spring.data.redis.lettuce.pool.max-wait=2000

# Lettuce connection settings to prevent reconnection loops
# Shutdown timeout for graceful shutdown
spring.data.redis.lettuce.shutdown-timeout=100
# Enable automatic reconnection (default: true)
spring.data.redis.lettuce.cluster.refresh.adaptive=true
spring.data.redis.lettuce.cluster.refresh.period=30s

# Redis Message Listener Configuration
# Task executor for processing Redis Pub/Sub messages
spring.data.redis.listener.task-executor.core-pool-size=5
spring.data.redis.listener.task-executor.max-pool-size=10
spring.data.redis.listener.task-executor.queue-capacity=100
# Subscription executor for managing channel subscriptions
spring.data.redis.listener.subscription-executor.core-pool-size=5
spring.data.redis.listener.subscription-executor.max-pool-size=10

#============================ JPA Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=1000
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

#============================ Jackson Configuration
# Configure Jackson to serialize Java 8 time types (Instant, LocalDateTime, etc.) as ISO-8601 strings
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false

#============================ Multipart File Upload Configuration
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=20MB
spring.servlet.multipart.max-request-size=20MB

#============================ Swagger Config
springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true
springdoc.paths-to-match=/api/**
springdoc.api-docs.path=/api/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui
springdoc.swagger-ui.use-root-path=true
springdoc.cache.disabled=true
# Note: Swagger UI will be available at both /swagger-ui/index.html and /api/swagger-ui/index.html
# Both paths are whitelisted in SecurityConfig

#============================ Admin Config
admin.username=${ADMIN_USER_NAME:admin}
admin.password=${ADMIN_PASSWORD:#Lenhat1605?}

#============================ JWT Config
ftes.jwt.secret=${FTES_JWT_SECRET:1TjXchw5FloESb63Kc+DFhTARvpWL4jUGCwfGWxuG5SIf/1y/LgJxHnMqaF6A/ij}

#============================ FTES API Config
ftes.api.base-url=${FTES_API_BASE_URL:https://api.ftes.vn}

#============================ Spring AI config
spring.ai.openai.chat.base-url=https://generativelanguage.googleapis.com
spring.ai.openai.chat.completions-path=/v1beta/openai/chat/completions
spring.ai.openai.chat.options.model=gemini-2.5-flash
spring.ai.openai.chat.options.reasoning-effort=medium
spring.ai.openai.api-key=${OPEN_API_KEY}

#============================ Security Config
security.cors.allowed-origin-patterns=https://sehub.ftes.vn,https://apisehub.ftes.vn,https://admin-sehub.ftes.vn,https://ai.ftes.vn,http://localhost:*,https://localhost:*,http://127.0.0.1:*,https://127.0.0.1:*

#============================ Chat Configuration
chat.message.max-length=${CHAT_MESSAGE_MAX_LENGTH:5000}
chat.participants.min=${CHAT_PARTICIPANTS_MIN:2}
chat.participants.max=${CHAT_PARTICIPANTS_MAX:100}
chat.session.ttl-hours=${CHAT_SESSION_TTL_HOURS:24}
chat.session.heartbeat-interval-minutes=${CHAT_SESSION_HEARTBEAT_INTERVAL_MINUTES:5}

#============================ Google Drive Configuration
# Set to true to enable Google Drive integration (requires valid credentials)
google.drive.enabled=${GOOGLE_DRIVE_ENABLED:false}
google.drive.client_id=${GOOGLE_DRIVE_CLIENT_ID:}
google.drive.client_secret=${GOOGLE_DRIVE_CLIENT_SECRET:}
google.drive.project_id=${GOOGLE_DRIVE_PROJECT_ID:}
google.drive.tokens.dir=${GOOGLE_DRIVE_TOKENS_DIR:tokens}
google.drive.application.name=${GOOGLE_DRIVE_APPLICATION_NAME:SE-HUB}
google.drive.image.folder.id=${GOOGLE_DRIVE_IMAGE_FOLDER_ID:1G69bLXUj3mzyqIdGK1HjMd8NBiGXZGlP}
google.drive.callback.url=${GOOGLE_DRIVE_CALLBACK_URL:https://apisehub.ftes.vn/api/drive/callback}
google.drive.folder.id=${GOOGLE_DRIVE_FOLDER_ID:1ynIrzm9Y9fmqCXKjMTUBWQcQLgc1ufnX}